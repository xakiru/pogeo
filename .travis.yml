matrix:
  include:
    - os: linux
      dist: trusty
      python: 3.5
      sudo: required
      language: python
      compiler: clang
      env: COMPILER='clang++-3.9' CC='clang-3.9' CXX='clang++-3.9'
      addons:
        apt:
          sources:
            - ['llvm-toolchain-trusty-3.9', 'ubuntu-toolchain-r-test']
          packages:
            - 'clang-3.9'
    - os: linux
      dist: trusty
      python: 3.6
      sudo: required
      language: python
      compiler: g++
      env: COMPILER='g++-6' CC='gcc-6' CXX='g++-6'
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
          packages:
            - g++-6
    - os: osx
      osx_image: xcode7.3
      language: generic
    - os: osx
      osx_image: xcode8.2
      language: generic
    - sudo: required
      services:
        - docker
      env: DOCKER_IMAGE=quay.io/pypa/manylinux1_x86_64
    - sudo: required
      services:
        - docker
      env: DOCKER_IMAGE=quay.io/pypa/manylinux1_i686
           PRE_CMD=linux32

before_install:
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew update && brew install python3; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then sudo update-alternatives --install /usr/bin/gcc gcc "/usr/bin/${COMPILER}" 1; sudo update-alternatives --install /usr/bin/g++ g++ "/usr/bin/${COMPILER}" 1; fi

install:
  - docker pull $DOCKER_IMAGE
  - pip3 install -U setuptools wheel
  - python3 setup.py install

script:
  - docker run --rm -v `pwd`:/io $DOCKER_IMAGE $PRE_CMD /io/travis/build-wheels.sh
  - ls wheelhouse/
  - python3 test.py
